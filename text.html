<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 笔记阅读器</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }

        /* 整体布局 */
        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* 左侧导航栏 */
        .sidebar {
            width: 300px;
            background-color: #f5f7fa;
            border-right: 1px solid #e4e7ed;
            padding: 24px 16px;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e4e7ed;
            font-weight: 600;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: block;
            padding: 8px 12px;
            color: #4b5563;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .nav-link:hover {
            background-color: #e2e8f0;
            color: #2563eb;
        }

        .nav-link.active {
            background-color: #2563eb;
            color: #ffffff;
        }

        /* 层级缩进 */
        .nav-level-2 {
            padding-left: 16px;
        }

        .nav-level-3 {
            padding-left: 32px;
        }

        /* 右侧内容区 */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            background-color: #ffffff;
        }

        .markdown-content {
            max-width: 1000px;
            margin: 0 auto;
            line-height: 1.8;
        }

        /* Markdown 基础样式 */
        .markdown-content h1 {
            font-size: 32px;
            color: #1f2937;
            margin: 32px 0 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e4e7ed;
        }

        .markdown-content h2 {
            font-size: 24px;
            color: #1f2937;
            margin: 24px 0 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .markdown-content h3 {
            font-size: 20px;
            color: #1f2937;
            margin: 20px 0 10px;
        }

        .markdown-content p {
            margin: 12px 0;
            color: #374151;
            font-size: 16px;
        }

        /* ========== 重点：代码块样式（灰框独立区域） ========== */
        /* 单行代码（`包裹`） */
        .markdown-content code {
            background-color: #f3f4f6; /* 浅灰色背景 */
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Consolas", "Monaco", monospace;
            color: #dc2626;
            font-size: 14px;
        }

        /* 多行代码块（```包裹```）- 核心灰框样式 */
        .markdown-content pre {
            background-color: #f9fafb !important; /* 代码块背景色（浅灰） */
            border: 1px solid #e4e7ed !important; /* 灰色边框（灰框） */
            border-radius: 8px !important; /* 圆角 */
            padding: 20px !important; /* 内边距，让代码和边框有间距 */
            margin: 20px 0 !important; /* 上下外边距，和其他内容分开 */
            overflow-x: auto !important; /* 横向滚动（代码过长时） */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important; /* 轻微阴影，更突出 */
        }

        /* 代码块内的文字样式（取消单行代码的背景色） */
        .markdown-content pre code {
            background: none !important;
            color: #1f2937 !important;
            padding: 0 !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
        }

        /* 列表/表格样式 */
        .markdown-content ul, .markdown-content ol {
            margin: 12px 0 12px 24px;
            color: #374151;
        }

        .markdown-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
        }

        .markdown-content table th, .markdown-content table td {
            border: 1px solid #e4e7ed;
            padding: 8px 12px;
            text-align: left;
        }

        .markdown-content table th {
            background-color: #f9fafb;
            font-weight: 600;
        }

        /* 加载提示 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 18px;
            color: #6b7280;
        }

        /* 响应式适配 */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid #e4e7ed;
            }

            .content {
                height: calc(100vh - 200px);
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="sidebar-title">笔记导航</div>
            <ul class="nav-list" id="navList"></ul>
        </div>

        <!-- 右侧内容区 -->
        <div class="content">
            <div class="markdown-content" id="markdownContent">
                <div class="loading">正在加载 21.md 文件...</div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', async function() {
            const navList = document.getElementById('navList');
            const markdownContent = document.getElementById('markdownContent');

            try {
                // 1. 加载本地21.md文件（注意：浏览器本地文件访问有安全限制）
                const response = await fetch('21.md');
                if (!response.ok) {
                    throw new Error(`加载失败：${response.status} ${response.statusText}`);
                }
                const markdownText = await response.text();

                // 2. 解析Markdown为HTML（确保代码块解析正确）
                marked.setOptions({
                    breaks: true, // 换行符转换为<br>
                    gfm: true,    // 启用GitHub风格的Markdown
                    pedantic: false
                });
                const htmlContent = marked.parse(markdownText);
                markdownContent.innerHTML = htmlContent;

                // 3. 提取标题生成导航
                generateNavigation();

                // 4. 绑定锚点平滑滚动
                bindSmoothScroll();

            } catch (error) {
                // 加载失败提示
                markdownContent.innerHTML = `
                    <div style="color: #dc2626; font-size: 18px; text-align: center; margin-top: 50px;">
                        加载 21.md 失败：${error.message}<br>
                        <small style="color: #6b7280; margin-top: 10px; display: block;">
                            请确保 21.md 文件与当前HTML文件在同一目录，且通过本地服务器运行（如Live Server）
                        </small>
                    </div>
                `;
                console.error('加载MD文件出错：', error);
            }
        });

        // 生成导航列表
        function generateNavigation() {
            const navList = document.getElementById('navList');
            const headings = document.querySelectorAll('.markdown-content h1, .markdown-content h2, .markdown-content h3');

            headings.forEach((heading, index) => {
                // 给每个标题添加唯一ID
                const headingId = `heading-${index}`;
                heading.id = headingId;

                // 创建导航项
                const navItem = document.createElement('li');
                navItem.className = 'nav-item';

                const navLink = document.createElement('a');
                navLink.href = `#${headingId}`;
                navLink.className = `nav-link ${
                    heading.tagName === 'H2' ? 'nav-level-2' :
                    heading.tagName === 'H3' ? 'nav-level-3' : ''
                }`;
                navLink.textContent = heading.textContent;

                // 点击高亮当前导航
                navLink.addEventListener('click', function() {
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                });

                navItem.appendChild(navLink);
                navList.appendChild(navItem);
            });

            // 默认高亮第一个导航项
            const firstLink = navList.querySelector('.nav-link');
            if (firstLink) {
                firstLink.classList.add('active');
            }
        }

        // 绑定平滑滚动
        function bindSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').slice(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }
    </script>
</body>
</html>